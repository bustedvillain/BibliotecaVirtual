$(document).ready(function(){debug=true;try{Encoder.EncodeType="entity"}catch(k){console.log("Libreria Encoder no habilitada")}try{$(".datatable").DataTable({language:{sLengthMenu:"Mostrando _MENU_ registros por tabla",sZeroRecords:"No se encuentran registros",sInfo:"Mostrando de _START_ al _END_ de _TOTAL_ totales",sInfoEmpty:"",sInfoFiltered:"(filtrado de _MAX_ registros totales)",sSearch:"Buscar:",oPaginate:{sNext:"Siguiente",sPrevious:"Anterior"},aaSorting:[[2,"desc"]]}})}catch(k){console.log("Datatables no habilitado")}try{if(mensaje_notificacion!=""){l(mensaje_notificacion,notification_type)}function l(q,e){setTimeout(function(){var r="";if(e!==undefined){if(e==="check"){r='<div class="ns-thumb"><img src="../img/check.png" width="66" /></div><div class="ns-content"><p>'+q+".</p></div>"}else{r='<div class="ns-thumb"><img src="../img/cross.png" width="66" /></div><div class="ns-content"><p>'+q+".</p></div>"}}else{}var s=new NotificationFx({message:r,layout:"other",ttl:6000,effect:"thumbslider",type:"notice",onClose:function(){}});s.show()},1200)}}catch(k){console.log("Notificaciones deshabilitadas")}$(".invisible").hide();$("body").on("click",".editaAtributo",function(q){f();var t=$(this).attr("id");var s=$(this).attr("nombre_atributo");var r=$(this).attr("entidad");var e=$(this).attr("id_nombre");g("Getting idAtributo:"+t);$.post("../sources/ControladorAdmin.php",{consulta:"consultaAtributo",id:t,nombre_atributo:s,entidad:r,id_nombre:e},function(v){b();g(v);var u=jQuery.parseJSON(v);$("#editaAtributo").val(Encoder.htmlDecode(u.nombre_atributo));$("#idAtributo").val(u.id_atributo)})});function g(e){if(debug===true){console.log(e)}}try{ZeroClipboard.config({moviePath:"../libs/zeroclipboard/ZeroClipboard.swf"});var d=new ZeroClipboard($(".copy-clipboard"));d.on("load",function(e){console.log("ZeroClipboard loaded");e.on("datarequested",function(q){var r="Texto copiado!";q.setText(r)});e.on("complete",function(q,r){console.log("Text copied to clipboard: \n"+r.text);l("Token de acceso copiado al portapapeles: "+r.text,"check")})});d.on("wrongflash noflash",function(){ZeroClipboard.destroy();l("Token de acceso no copiado al portapapeles: "+args.text,"cross")})}catch(k){console.log("ZeroClipboard no habiitado")}$("body").on("click",".editaInstancia",function(e){f();g("Editar instancia");var q=$(this).attr("id");$.post("../sources/ControladorAdmin.php",{consulta:"consultaInstancia",id:q},function(s){b();g(s);var r=jQuery.parseJSON(s);g(Encoder.htmlDecode(r[0].nombre_instancia));$("#editaAtributo").val(Encoder.htmlDecode(r[0].nombre_instancia));$("#id_instancia").val(q)})});var m=true;$("#contrasenaAutomatica").click(function(e){m=!m;j()});j();function j(){if(m){$("#password").removeAttr("disabled")}else{$("#password").attr("disabled","enabled")}}"use strict";var p={};p.ui={container:"#pwd-container",showVerdictsInsideProgressBar:true,viewports:{progress:".pwstrength_viewport_progress"}};p.common={debug:true,onLoad:function(){$("#messages").text("Empiece a introducir la contraseña")}};try{$(":password").pwstrength(p)}catch(k){console.log("No se cargo la librería pwstrenght:"+k)}var h=false;$("#cambiarContrasena").change(function(){h=!h;o();g("cambiarContrasena:"+h)});o();function o(){if(h){$("#editaPassword").removeAttr("disabled");$("#checkCambAutomPass").show("fast")}else{$("#editaPassword").attr("disabled","enabled");$("#checkCambAutomPass").hide("fast")}}var a=true;$("#contrasenaAutomaticaEditar").change(function(e){a=!a;n();g("contrasenaAutomaticaEditar:"+a)});$("#checkCambAutomPass").hide();function n(){if(a){$("#editaPassword").removeAttr("disabled")}else{$("#editaPassword").attr("disabled","enabled")}}$("body").on("click",".editaAdmin",function(e){f();g("Editar Admin");var q=$(this).attr("id");$.post("../sources/ControladorAdmin.php",{consulta:"consultaAdmin",id:q},function(s){b();var r=jQuery.parseJSON(s);g(r);$("#editaNombre").val(Encoder.htmlDecode(r[0].nombre));$("#editaNombreUsuario").val(Encoder.htmlDecode(r[0].nombre_usuario));$("#editaCorreo").val(Encoder.htmlDecode(r[0].correo));$("#id_administrador").val(q)})});$("#tipo-libro").change(function(){if($(this).val()==="0"){$("#url-externa").hide("fast");$("#libro-gratuito").show("fast")}else{$("#url-externa").show("fast");$("#libro-gratuito").hide("fast")}});$("#tipo-libro").change();$("#edita-tipo-libro").change(function(){if($(this).val()==="0"){$("#url-externa2").hide("fast");$("#libro-gratuito2").show("fast")}else{$("#url-externa2").show("fast");$("#libro-gratuito2").hide("fast")}});function i(r,t){var q=r;if(q.length>0){var s=q[0];var e=new FileReader();e.onload=function(u){codigoImagen=u.target.result;t(codigoImagen)};e.readAsDataURL(s)}}$("#input-imagen").change(function(){i($(this)["context"].files,function(e){$("#muestra-imagen").html("<center><img class='img-rounded' src='"+e+"' width='50%'/></center>")})});$("#input-imagen2").change(function(){i($(this)["context"].files,function(e){$("#muestra-imagen2").html("<center><img class='img-rounded' src='"+e+"' width='50%'/></center>")})});$("body").on("click",".verLibro",function(e){console.log("VER LIBROO");f();g("Ver detalles libro:"+$(this).attr("id"));var q=$(this).attr("id");$.post("../sources/ControladorAdmin.php",{consulta:"consultaLibro",id:q},function(s){b();g(s);var r=jQuery.parseJSON(s);g(r);$("#ver-imagen").html("<img width='100%' style='width:100%;' class='img-rounded' src='"+r[0].imagen+"'/>");$("#ver-nombre").html(Encoder.htmlDecode(r[0].nombre_libro));$("#ver-descripcion").html(Encoder.htmlDecode(r[0].descripcion));$("#ver-anio").html(r[0].anio);$("#ver-autor").html(Encoder.htmlDecode(r[0].nombre_autor));$("#ver-editorial").html(Encoder.htmlDecode(r[0].nombre_editorial));$("#ver-clase").html(Encoder.htmlDecode(r[0].nombre_clase));$("#ver-nivel").html(Encoder.htmlDecode(r[0].nombre_nivel));if(r[0].tipo_libro=="0"){$("#ver-tipo").html("Gratuito")}else{if(r[0].tipo_libro=="1"){$("#ver-tipo").html("Paga")}}$("#ver-fecha").html(r[0].fecha_inclusion);$("#ver-admin").html(Encoder.htmlDecode(r[0].nombre));$("#ver-libro").html('<a title="Ver Libro" href="'+r[0].url_archivo+'" target="top">Ver Libro </a>')})});$("body").on("click",".editarLibro",function(e){f();g("Editar libro:"+$(this).attr("id"));var q=$(this).attr("id");$.post("../sources/ControladorAdmin.php",{consulta:"consultaLibro",id:q},function(s){b();g(s);var r=jQuery.parseJSON(s);g(r);$("#edita-nombre-libro").val(Encoder.htmlDecode(r[0].nombre_libro));$("#edita-descripcion").val(Encoder.htmlDecode(r[0].descripcion));$("#edita-anio").val(r[0].anio);$("#edita-autor option[value="+r[0].id_autor+"]").attr("selected",true);$("#edita-editorial option[value="+r[0].id_editorial+"]").attr("selected",true);$("#edita-clase option[value="+r[0].id_clase+"]").attr("selected",true);$("#edita-nivel option[value="+r[0].id_nivel_educativo+"]").attr("selected",true);$("#edita-tipo-libro option[value="+r[0].tipo_libro+"]").attr("selected",true);$("#edita-tipo-libro").change();$("#edita-url-externa").val(r[0].url_archivo);$("#id_libro").val(q)})});$("form").submit(function(){$("button[type=submit]").html("Enviando...");$("button").attr("disabled","disabled")});$("#guardarLibro").click(function(){if($("#tipo-libro").val()=="1"){$("#libro-gratuito").remove()}if($("#selecciona-autor").val()!="0"){$("#otro-autor").remove()}if($("#selecciona-editorial").val()!="0"){$("#otra-editorial").remove()}if($("#selecciona-clase").val()!="0"){$("#otra-clase").remove()}});$("#guardaEdicionLibro").click(function(){if($("#tipo-libro2").val()=="1"){$("#libro-gratuito2").remove()}if($("#edita-autor").val()!="0"){$("#otro-autor2").remove()}if($("#edita-editorial").val()!="0"){$("#otra-editorial2").remove()}if($("#edita-clase").val()!="0"){$("#otra-clase2").remove()}});function f(){c=$(".modal-title").html();var e=c+'<div class="loader"><span></span><span></span><span></span><br>Cargando datos...</div>';$(".modal-title").html(e)}function b(){$(".loader").fadeOut("slow")}var c="";$("#otro-autor").hide();$("#otra-editorial").hide();$("#otra-clase").hide();$("#otro-autor2").hide();$("#otra-editorial2").hide();$("#otra-clase2").hide();$("#selecciona-autor").change(function(){if($(this).val()=="0"){$("#otro-autor").show("fast")}else{$("#otro-autor").hide("fast")}});$("#selecciona-editorial").change(function(){if($(this).val()=="0"){$("#otra-editorial").show("fast")}else{$("#otra-editorial").hide("fast")}});$("#selecciona-clase").change(function(){if($(this).val()=="0"){$("#otra-clase").show("fast")}else{$("#otra-clase").hide("fast")}});$("#edita-autor").change(function(){if($(this).val()=="0"){$("#otro-autor2").show("fast")}else{$("#otro-autor2").hide("fast")}});$("#edita-editorial").change(function(){if($(this).val()=="0"){$("#otra-editorial2").show("fast")}else{$("#otra-editorial2").hide("fast")}});$("#edita-clase").change(function(){if($(this).val()=="0"){$("#otra-clase2").show("fast")}else{$("#otra-clase2").hide("fast")}});$("#login").submit(function(s){$("#loading").html('<div class="loader"><span></span><span></span><span></span><br>Iniciando Sesi&oacute;n...</div>');var q=$("#email").val();var r=$("#pass").val();var e=$("#recordarme").prop("checked");$.post("verificaLogin.php",{correo:q,pass:r,recordarme:e},function(t){t=$.parseJSON(t);console.log(t);if(t!==false){$("#loading").html('<div class="alert alert-success" role="alert">Bienvenido: '+t.nombre+", redireccionando...</div>");setTimeout(function(){window.location="../dashboard/?notification=Bienvenido(a) "+t.nombre+"&notification_type=check"},1500)}else{$("#loading").html('<div class="alert alert-danger" role="alert">Credenciales de acceso incorrectas</div>');$("#loading").html('<div class="alert alert-danger" role="alert">Credenciales de acceso incorrectas</div>');$("button[type=submit]").html("Iniciar Sesi&oacute;n");$("button").removeAttr("disabled")}});s.preventDefault()})});