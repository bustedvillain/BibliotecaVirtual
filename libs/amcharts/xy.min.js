AmCharts.AmXYChart=AmCharts.Class({inherits:AmCharts.AmRectangularChart,construct:function(b){this.type="xy";AmCharts.AmXYChart.base.construct.call(this,b);this.cname="AmXYChart";this.theme=b;this.createEvents("zoomed");this.maxZoomFactor=20;AmCharts.applyTheme(this,b,this.cname)},initChart:function(){AmCharts.AmXYChart.base.initChart.call(this);this.dataChanged&&(this.updateData(),this.dataChanged=!1,this.dispatchDataUpdated=!0);this.updateScrollbar=!0;this.drawChart();this.autoMargins&&!this.marginsUpdated&&(this.marginsUpdated=!0,this.measureMargins());var f=this.marginLeftReal,h=this.marginTopReal,e=this.plotAreaWidth,g=this.plotAreaHeight;this.graphsSet.clipRect(f,h,e,g);this.bulletSet.clipRect(f,h,e,g);this.trendLinesSet.clipRect(f,h,e,g)},prepareForExport:function(){var b=this.bulletSet;b.clipPath&&this.container.remove(b.clipPath)},createValueAxes:function(){var h=[],l=[];this.xAxes=h;this.yAxes=l;var g=this.valueAxes,k,j;for(j=0;j<g.length;j++){k=g[j];var i=k.position;if("top"==i||"bottom"==i){k.rotate=!0}k.setOrientation(k.rotate);i=k.orientation;"V"==i&&l.push(k);"H"==i&&h.push(k)}0===l.length&&(k=new AmCharts.ValueAxis(this.theme),k.rotate=!1,k.setOrientation(!1),g.push(k),l.push(k));0===h.length&&(k=new AmCharts.ValueAxis(this.theme),k.rotate=!0,k.setOrientation(!0),g.push(k),h.push(k));for(j=0;j<g.length;j++){this.processValueAxis(g[j],j)}h=this.graphs;for(j=0;j<h.length;j++){this.processGraph(h[j],j)}},drawChart:function(){AmCharts.AmXYChart.base.drawChart.call(this);AmCharts.ifArray(this.chartData)?(this.chartScrollbar&&this.updateScrollbars(),this.zoomChart()):this.cleanChart();if(this.hideXScrollbar){var b=this.scrollbarH;b&&(this.removeListener(b,"zoomed",this.handleHSBZoom),b.destroy());this.scrollbarH=null}if(this.hideYScrollbar){if(b=this.scrollbarV){this.removeListener(b,"zoomed",this.handleVSBZoom),b.destroy()}this.scrollbarV=null}if(!this.autoMargins||this.marginsUpdated){this.dispDUpd(),this.chartCreated=!0,this.zoomScrollbars()}},cleanChart:function(){AmCharts.callMethod("destroy",[this.valueAxes,this.graphs,this.scrollbarV,this.scrollbarH,this.chartCursor])},zoomChart:function(){this.toggleZoomOutButton();this.zoomObjects(this.valueAxes);this.zoomObjects(this.graphs);this.zoomTrendLines();this.dispatchAxisZoom()},toggleZoomOutButton:function(){1==this.heightMultiplier&&1==this.widthMultiplier?this.showZB(!1):this.showZB(!0)},dispatchAxisZoom:function(){var h=this.valueAxes,l;for(l=0;l<h.length;l++){var g=h[l];if(!isNaN(g.min)&&!isNaN(g.max)){var k,j;"V"==g.orientation?(k=g.coordinateToValue(-this.verticalPosition),j=g.coordinateToValue(-this.verticalPosition+this.plotAreaHeight)):(k=g.coordinateToValue(-this.horizontalPosition),j=g.coordinateToValue(-this.horizontalPosition+this.plotAreaWidth));if(!isNaN(k)&&!isNaN(j)){if(k>j){var i=j;j=k;k=i}g.dispatchZoomEvent(k,j)}}}},zoomObjects:function(f){var h=f.length,e;for(e=0;e<h;e++){var g=f[e];g.minTemp=g.min;g.maxTemp=g.max;this.updateObjectSize(g);g.zoom(0,this.chartData.length-1)}g.minTemp=NaN;g.maxTemp=NaN},updateData:function(){this.parseData();var t=this.chartData,r=t.length-1,s=this.graphs,q=this.dataProvider,p=-Infinity,o=Infinity,j,n;for(j=0;j<s.length;j++){if(n=s[j],n.data=t,n.zoom(0,r),n=n.valueField){var i;for(i=0;i<q.length;i++){var l=Number(q[i][n]);l>p&&(p=l);l<o&&(o=l)}}}for(j=0;j<s.length;j++){n=s[j],n.maxValue=p,n.minValue=o}if(t=this.chartCursor){t.updateData(),t.type="crosshair",t.valueBalloonsEnabled=!1}},zoomOut:function(){this.verticalPosition=this.horizontalPosition=0;this.heightMultiplier=this.widthMultiplier=1;this.zoomChart();this.zoomScrollbars()},processValueAxis:function(b){b.chart=this;b.minMaxField="H"==b.orientation?"x":"y";b.min=NaN;b.max=NaN;this.listenTo(b,"axisSelfZoomed",this.handleAxisSelfZoom)},processGraph:function(b){AmCharts.isString(b.xAxis)&&(b.xAxis=this.getValueAxisById(b.xAxis));AmCharts.isString(b.yAxis)&&(b.yAxis=this.getValueAxisById(b.yAxis));b.xAxis||(b.xAxis=this.xAxes[0]);b.yAxis||(b.yAxis=this.yAxes[0]);b.valueAxis=b.yAxis},parseData:function(){AmCharts.AmXYChart.base.parseData.call(this);this.chartData=[];var B=this.dataProvider,z=this.valueAxes,A=this.graphs,y;if(B){for(y=0;y<B.length;y++){var x={axes:{},x:{},y:{}},w=B[y],t;for(t=0;t<z.length;t++){var v=z[t].id;x.axes[v]={};x.axes[v].graphs={};var r;for(r=0;r<A.length;r++){var u=A[r],i=u.id;if(u.xAxis.id==v||u.yAxis.id==v){var o={};o.serialDataItem=x;o.index=y;var j={},s=Number(w[u.valueField]);isNaN(s)||(j.value=s);s=Number(w[u.xField]);isNaN(s)||(j.x=s);s=Number(w[u.yField]);isNaN(s)||(j.y=s);s=Number(w[u.errorField]);isNaN(s)||(j.error=s);o.values=j;this.processFields(u,o,w);o.serialDataItem=x;o.graph=u;x.axes[v].graphs[i]=o}}}this.chartData[y]=x}}},formatString:function(f,h,e){var g=h.graph.numberFormatter;g||(g=this.nf);f=AmCharts.formatValue(f,h.values,["value","x","y"],g);-1!=f.indexOf("[[")&&(f=AmCharts.formatDataContextValue(f,h.dataContext));return f=AmCharts.AmXYChart.base.formatString.call(this,f,h,e)},addChartScrollbar:function(e){AmCharts.callMethod("destroy",[this.chartScrollbar,this.scrollbarH,this.scrollbarV]);if(e){this.chartScrollbar=e;this.scrollbarHeight=e.scrollbarHeight;var f="backgroundColor backgroundAlpha selectedBackgroundColor selectedBackgroundAlpha scrollDuration resizeEnabled hideResizeGrips scrollbarHeight updateOnReleaseOnly".split(" ");if(!this.hideYScrollbar){var d=new AmCharts.SimpleChartScrollbar(this.theme);d.skipEvent=!0;d.chart=this;this.listenTo(d,"zoomed",this.handleVSBZoom);AmCharts.copyProperties(e,d,f);d.rotate=!0;this.scrollbarV=d}this.hideXScrollbar||(d=new AmCharts.SimpleChartScrollbar(this.theme),d.skipEvent=!0,d.chart=this,this.listenTo(d,"zoomed",this.handleHSBZoom),AmCharts.copyProperties(e,d,f),d.rotate=!1,this.scrollbarH=d)}},updateTrendLines:function(){var f=this.trendLines,h;for(h=0;h<f.length;h++){var e=f[h],e=AmCharts.processObject(e,AmCharts.TrendLine,this.theme);f[h]=e;e.chart=this;var g=e.valueAxis;AmCharts.isString(g)&&(e.valueAxis=this.getValueAxisById(g));g=e.valueAxisX;AmCharts.isString(g)&&(e.valueAxisX=this.getValueAxisById(g));e.valueAxis||(e.valueAxis=this.yAxes[0]);e.valueAxisX||(e.valueAxisX=this.xAxes[0])}},updateMargins:function(){AmCharts.AmXYChart.base.updateMargins.call(this);var b=this.scrollbarV;b&&(this.getScrollbarPosition(b,!0,this.yAxes[0].position),this.adjustMargins(b,!0));if(b=this.scrollbarH){this.getScrollbarPosition(b,!1,this.xAxes[0].position),this.adjustMargins(b,!1)}},updateScrollbars:function(){AmCharts.AmXYChart.base.updateScrollbars.call(this);var b=this.scrollbarV;b&&(this.updateChartScrollbar(b,!0),b.draw());if(b=this.scrollbarH){this.updateChartScrollbar(b,!1),b.draw()}},zoomScrollbars:function(){var b=this.scrollbarH;b&&b.relativeZoom(this.widthMultiplier,-this.horizontalPosition/this.widthMultiplier);(b=this.scrollbarV)&&b.relativeZoom(this.heightMultiplier,-this.verticalPosition/this.heightMultiplier)},fitMultiplier:function(b){b>this.maxZoomFactor&&(b=this.maxZoomFactor);return b},fitH:function(e,f){var d=-(this.plotAreaWidth*f-this.plotAreaWidth);e<d&&(e=d);this.horizontalPosition=e},fitV:function(e,f){var d=-(this.plotAreaHeight*f-this.plotAreaHeight);e<d&&(e=d);this.verticalPosition=e},handleHSBZoom:function(b){var d=this.fitMultiplier(b.multiplier);this.fitH(-b.position*d,d);this.widthMultiplier=d;this.zoomChart()},handleVSBZoom:function(b){var d=this.fitMultiplier(b.multiplier);this.fitV(-b.position*d,d);this.heightMultiplier=d;this.zoomChart()},handleAxisSelfZoom:function(b){if("H"==b.valueAxis.orientation){var d=this.fitMultiplier(b.multiplier);this.fitH(-b.position*d,d);this.widthMultiplier=d}else{d=this.fitMultiplier(b.multiplier),this.fitV(-b.position*d,d),this.heightMultiplier=d}this.zoomChart();b=this.graphs;for(d=0;d<b.length;d++){b[d].setAnimationPlayed()}this.zoomScrollbars()},handleCursorZoom:function(f){var h=this.widthMultiplier*this.plotAreaWidth/f.selectionWidth,e=this.heightMultiplier*this.plotAreaHeight/f.selectionHeight,h=this.fitMultiplier(h),e=this.fitMultiplier(e),g=(this.verticalPosition-f.selectionY)*e/this.heightMultiplier;this.fitH((this.horizontalPosition-f.selectionX)*h/this.widthMultiplier,h);this.fitV(g,e);this.widthMultiplier=h;this.heightMultiplier=e;this.zoomChart();this.zoomScrollbars()},removeChartScrollbar:function(){AmCharts.callMethod("destroy",[this.scrollbarH,this.scrollbarV]);this.scrollbarV=this.scrollbarH=null},handleReleaseOutside:function(b){AmCharts.AmXYChart.base.handleReleaseOutside.call(this,b);AmCharts.callMethod("handleReleaseOutside",[this.scrollbarH,this.scrollbarV])}});